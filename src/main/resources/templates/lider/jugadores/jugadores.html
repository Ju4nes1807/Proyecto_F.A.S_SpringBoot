<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="/images/Logo.png" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <title>Jugadores</title>
  <style>
    .list-group-item.active {
      z-index: 2;
      color: #fff;
      background-color: #0d6efd;
      border-color: #0d6efd;
    }
  </style>
</head>

<body class="d-flex flex-column min-vh-100">
  <div th:replace="fragments/modalConfirmacion :: modalConfirmacion"></div>

  <div class="navbar navbar-expand bg-primary lg-4 shadow mb-4">
    <a href="#">
      <img src="/images/Logo.png" alt="Logo" class="img-fluid me-2" style="width: 75px; height: 75px;" />
    </a>
    <p class="navbar-brand text-light fs-2 shadow">F.A.S</p>
    <div class="collapse navbar-collapse" id="navNavbarDropdown">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <form method="POST" th:action="@{/logout}">
            <button type="submit" class="nav-link text-light shadow">Cerrar sesión</button>
          </form>
        </li>
        <li class="nav-item">
          <a th:href="@{/lider/perfil/modificar}" class="nav-link text-light shadow">Modificar Perfil</a>
        </li>
      </ul>
    </div>
  </div>

  <main class="container-fluid flex-grow-1">
    <div class="row">
      <div class="col-md-3 col-lg-2 sidebar mb-3">
        <h5 class="mb-3 text-primary">Jugadores</h5>
        <div class="list-group">
          <a th:href="@{/lider/dashboard}" class="list-group-item list-group-item-action">Inicio</a>
          <a href="#" class="list-group-item list-group-item-action">Entrenamientos</a>
          <a th:href="@{/torneos/lider}" class="list-group-item list-group-item-action">Torneos</a>
          <a th:href="@{/categorias}" class="list-group-item list-group-item-action">Categorías</a>
          <a th:href="@{/canchas}" class="list-group-item list-group-item-action">Canchas</a>
          <a th:href="@{/jugadores}" class="list-group-item list-group-item-action active">Jugadores</a>
        </div>
      </div>

      <div class="col-md-9 col-lg-10 p-4">

        <!-- Mensajes de alerta -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
          <span th:text="${success}"></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
          <span th:text="${error}"></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        <div th:if="${warningMessage}" class="alert alert-warning alert-dismissible fade show" role="alert">
          <strong th:text="${warningMessage}"></strong>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <h3 class="mt-3"><i class="fas fa-user me-1"></i>Jugadores</h3>

        <div class="d-flex flex-column flex-md-row align-items-center justify-content-md-between mb-3">
          <form class="d-flex flex-grow-1 me-md-2 align-items-center" th:action="@{/jugadores}" method="GET"
            role="search">
            <div class="input-group flex-grow-1 me-2">
              <span class="input-group-text"><i class="fas fa-search"></i></span>
              <input class="form-control" type="search" name="nombre" placeholder="Nombre..."
                th:value="${requestNombre}" />
            </div>

            <div class="input-group flex-grow-1 me-2">
              <span class="input-group-text">Categoría</span>
              <select class="form-select" name="categoriaId">
                <option value="">Todas</option>
                <option th:each="cat : ${categorias}" th:value="${cat.idCategoria}" th:text="${cat.nombre}"
                  th:selected="${cat.idCategoria == requestCategoria}">
                </option>
              </select>
            </div>

            <div class="input-group flex-grow-1 me-2">
              <span class="input-group-text">Posición</span>
              <input class="form-control" type="search" name="posicion" placeholder="Posición..."
                th:value="${requestPosicion}" />
            </div>

            <button class="btn btn-primary me-2" type="submit">
              <i class="fas fa-filter"></i>
            </button>

            <a th:href="@{/jugadores}" class="btn btn-outline-warning">
              <i class="fas fa-sync-alt"></i>
            </a>
          </form>

          <a th:href="@{/jugadores/crear}" class="btn btn-warning mt-2 mt-md-0"
            th:classappend="${warningMessage != null} ? 'disabled' : ''" th:aria-disabled="${warningMessage != null}">
            <i class="fas fa-plus"></i> Agregar Jugador
          </a>
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th><i class="fas fa-user me-1"></i>Nombre</th>
                <th><i class="fas fa-envelope me-1"></i>Email</th>
                <th><i class="fas fa-futbol me-1"></i>Categoría</th>
                <th><i class="fas fa-shield-alt me-1"></i>Posición</th>
                <th><i class="fas fa-hashtag me-1"></i>Número</th>
                <th><i class="fas fa-gear me-1"></i>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="jugador : ${jugadores}">
                <td th:text="${jugador.nombres + ' ' + jugador.apellidos}"></td>
                <td th:text="${jugador.email}"></td>
                <td th:text="${jugador.nombreCategoria}"></td>
                <td th:text="${jugador.posicion}"></td>
                <td th:text="${jugador.numeroCamiseta}"></td>
                <td>
                  <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                    th:data-bs-target="'#jugadorModal' + ${jugador.idUsuario}">
                    <i class="fas fa-eye"></i>
                  </button>
                  <a th:href="@{/jugadores/editar/{id}(id=${jugador.idUsuario})}" class="btn btn-warning btn-sm">
                    <i class="fas fa-edit"></i>
                  </a>
                  <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal"
                    data-bs-target="#modalConfirmacion" th:data-form-id="'formEliminarJugador_' + ${jugador.idUsuario}">
                    <i class="fas fa-trash"></i>
                  </button>

                  <form th:id="'formEliminarJugador_' + ${jugador.idUsuario}"
                    th:action="@{/jugadores/eliminar/{id}(id=${jugador.idUsuario})}" method="post"
                    style="display:none;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                  </form>
                </td>
              </tr>
              <tr th:if="${#lists.isEmpty(jugadores)}">
                <td colspan="6" class="text-center">No se encontraron jugadores.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Modales para ver detalles -->
  <div th:each="jugador : ${jugadores}" class="modal fade" th:id="'jugadorModal' + ${jugador.idUsuario}" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-warning">
          <h5 class="modal-title">Información del Jugador</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group mb-3">
            <li class="list-group-item"><strong>Nombres:</strong> <span th:text="${jugador.nombres}"></span></li>
            <li class="list-group-item"><strong>Apellidos:</strong> <span th:text="${jugador.apellidos}"></span></li>
            <li class="list-group-item"><strong>Documento:</strong> <span th:text="${jugador.numDocumento}"></span></li>
            <li class="list-group-item"><strong>Email:</strong> <span th:text="${jugador.email}"></span></li>
            <li class="list-group-item"><strong>Teléfono:</strong> <span th:text="${jugador.telefono}"></span></li>
            <li class="list-group-item"><strong>Fecha de Nacimiento:</strong> <span
                th:text="${jugador.fechaNacimiento}"></span></li>
            <li class="list-group-item"><strong>Escuela:</strong> <span th:text="${jugador.nombreEscuela}"></span></li>
            <li class="list-group-item"><strong>Categoría:</strong> <span th:text="${jugador.nombreCategoria}"></span>
            </li>
            <li class="list-group-item"><strong>Posición:</strong> <span th:text="${jugador.posicion}"></span></li>
            <li class="list-group-item"><strong>Número de Camiseta:</strong> <span
                th:text="${jugador.numeroCamiseta}"></span></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-warning py-3 shadow mt-auto">
    <div class="container text-start d-flex align-items-center shadow">
      <img src="/images/Logo.png" alt="Logo" class="img-fluid me-2" style="width: 75px; height: 75px;" />
      <p class="text-dark m-0">© Football Association System. Todos los derechos reservados</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var formId = null;

      document.querySelectorAll('[data-bs-target="#modalConfirmacion"]').forEach(function (btn) {
        btn.addEventListener('click', function () {
          formId = btn.getAttribute('data-form-id');
        });
      });

      document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
        if (formId) {
          var form = document.getElementById(formId);
          if (form) {
            form.submit();
          }
        }
      });
    });
  </script>
</body>

</html>